chrome.extension.sendMessage({type: "background.js:getConfig"}, function (response) {
    window.localStorage.setItem('Mocker:config',response);
});

chrome.extension.sendMessage({type: "background.js:getStatus"}, function (response) {
    window.localStorage.setItem('Mocker:status',response || '');
});


var config = window.localStorage.getItem('Mocker:config');
var status = window.localStorage.getItem('Mocker:status');
try {
    var page = JSON.parse(config).page;
}catch (e) {

}


if(config && status && window.location.href.indexOf(page)>-1){
    var el = document.createElement('script');
    el.innerText = 'window.MockerInit = function(){Mocker('+config+')};!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=0)}([function(t,e,n){"use strict";var o=n(1);n(2),n(3),window.Mocker=function(t){if(t&&t.urls&&t.origin){console.log(t);var e=t,n=t.origin,r=t.token;window.location.href.indexOf("debugger=fdg")>-1&&(n="127.0.0.1:7001"),n="//"+n;var i=function(t){var n=!1;return e.urls.forEach(function(e){t.indexOf(e)>-1&&(n=!0)}),n};if(t.record)window.MockerMsg.on("ajaxback",function(t){if(i(t.url)&&-1===t.url.indexOf(n)){var e=n+"/api/contrasts?ac=record&token="+r;console.log(e),"post"===t.method.toLowerCase()&&(t.params&&o.isString(t.params)?t.body=o.TextToJson(t.params):t.body=t.params),t.params=t.url.replace(/^.+?\\?/,""),t.url.indexOf("?")>-1&&t.params&&t.params.trim()?t.params=o.TextToJson(t.params):t.params="";var s={url:t.url,method:t.method,params:t.params,body:t.body||"",resData:t.res};console.log(s);var c=new XMLHttpRequest;c.onreadystatechange=function(){},c.open("POST",e,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send(o.JSONtoGetText(s))}});else{var s=window.fetch;s&&"function"==typeof s&&(window.fetch=function(){return i(arguments[0])&&(/^http/.test(arguments[0])||(arguments[0]=window.location.protocol+arguments[0]),arguments[0]=n+"/api/mock?ac=get&token="+r+"&url="+encodeURIComponent(arguments[0])),s.apply(this,arguments)});var c=Document.prototype.createElement;Document.prototype.createElement=function(){var t=c.apply(this,arguments);return"script"===t.tagName.toLowerCase()&&t.__defineSetter__("src",function(t){if(i(t))return/^http/.test(t)||(t=window.location.protocol+t),n+"/api/mock?ac=get&token="+r+"&url="+encodeURIComponent(t)}),t};var a=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){i(arguments[1])&&(/^http/.test(arguments[1])||(arguments[1]=window.location.protocol+arguments[1]),arguments[1]=n+"/api/mock?ac=get&token="+r+"&url="+encodeURIComponent(arguments[1])),a.apply(this,arguments)}}}},window.MockerInit&&window.MockerInit()},function(t,e,n){"use strict";var o=function(t){return function(e){return Object.prototype.toString.call(e)==="[object "+t+"]"}},r={JSONtoGetText:function(t){var e=this,n=[];return Object.keys(t).forEach(function(o){var r=t[o];e.isArray(r)||e.isObject(r)?n.push(o+"="+encodeURIComponent(JSON.stringify(r))):n.push(o+"="+encodeURIComponent(r))}),n.length?n.join("&"):""},TextToJson:function(t){var e={};if(t.split("&").forEach(function(t){var n=t.split("=");try{e[n[0]]=JSON.parse(decodeURIComponent(n[1]))}catch(t){e[n[0]]=decodeURIComponent(n[1])}}),Object.keys(e).length)return e},isString:o("String"),isObject:o("Object"),isArray:o("Array")};t.exports=r},function(t,e,n){"use strict";var o=[],r={},i={on:function(t,e,n){o.push({name:t,cb:e}),n&&void 0!==r[t]&&e(r[t])},once:function(t,e,n){o.push({name:t,cb:e,once:!0}),n&&void 0!==r[t]&&e(r[t])},send:function(t,e){var n=this;o.forEach(function(o){o.name===t&&(o.cb(e),o.once&&n.remove(t,o.cb))}),r[t]=e},remove:function(t,e){for(var n=0;n<o.length;n++){var r=o[n];r.name===t&&(e?r.cb===e&&o.splice(n,1):o.splice(n,1))}}};window.MockerMsg=i},function(t,e,n){"use strict";n(4),n(5)},function(t,e,n){"use strict";var o=XMLHttpRequest.prototype.send,r=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){var t=this.msg={method:"",url:"",params:"",isAsync:!0,status:"",res:""};t.method=arguments[0],t.url=arguments[1],t.isAsync=arguments[2]||!0,r.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){var t=this.msg;t.params=arguments[0]||"";var e=this.onreadystatechange,n=this.ontimeout,r=this.onerror;this.onreadystatechange=function(){var n=this;4===this.readyState&&setTimeout(function(){try{t.status=n.status,200===n.status&&(t.res=n.responseText),window.MockerMsg.send("ajaxback",t)}catch(t){}}),e&&e.call(this)},this.ontimeout=function(){t.isTimeout=!0,n&&n.call(this)},this.onerror=function(){t.isError=!0,r&&r.call(this)},o.apply(this,arguments)}},function(t,e,n){"use strict";var o=window.fetch;o&&"function"==typeof o&&(window.fetch=function(){var t={method:"",url:"",params:arguments[1]?arguments[1].body:"",isAsync:!0,status:"",res:""},e=arguments[1]||{};return o.apply(this,arguments).then(function(n){return t.url=n.url,t.method=e.method||"GET",t.status=n.status,new Promise(function(o,r){"json"===e.dataType?n.json().then(function(e){n.json=function(){return new Promise(function(n){t.res=e,setTimeout(function(){window.MockerMsg.send("ajaxback",t)}),n(e)})},o(n)}):n.text().then(function(e){n.text=function(){return new Promise(function(n){t.res=e,setTimeout(function(){window.MockerMsg.send("ajaxback",t)}),n(e)})},o(n)})})})})}]);';
    document.documentElement.appendChild(el);
}



